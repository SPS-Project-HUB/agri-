<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Advanced Vehicle Control - Smart Agri Vehicle</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary-green: #2e7d32;
  --light-green: #4caf50;
  --dark-green: #1b5e20;
  --accent-blue: #2196f3;
  --warning-red: #f44336;
  --warning-orange: #ff9800;
  --neutral-gray: #757575;
  --light-gray: #f5f5f5;
  --dark-gray: #424242;
  --background: #f8fdf8;
  --card-bg: #ffffff;
  --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.15);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--background);
  color: #333;
  line-height: 1.6;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

/* Header */
.header {
  background: linear-gradient(135deg, var(--dark-green), var(--primary-green));
  color: white;
  padding: 25px 30px;
  border-radius: 16px;
  margin-bottom: 30px;
  box-shadow: var(--shadow);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  font-size: 2.2rem;
  display: flex;
  align-items: center;
  gap: 15px;
}

.header h1 i {
  font-size: 2.5rem;
}

.header-subtitle {
  font-size: 1rem;
  opacity: 0.9;
  margin-top: 5px;
}

.header-stats {
  display: flex;
  gap: 25px;
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #fff;
}

.stat-label {
  font-size: 0.9rem;
  opacity: 0.8;
}

/* Main Content */
.main-content {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 25px;
}

@media (max-width: 992px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}

/* Control Panel */
.control-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 30px;
  box-shadow: var(--shadow);
  border-top: 6px solid var(--primary-green);
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.panel-title {
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--dark-green);
  font-size: 1.6rem;
}

.mode-selector {
  display: flex;
  background: #f0f7f0;
  border-radius: 50px;
  padding: 5px;
}

.mode-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 50px;
  background: transparent;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.mode-btn.active {
  background: var(--primary-green);
  color: white;
  box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
}

/* Control Interface */
.control-interface {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
}

/* Direction Control */
.direction-control {
  background: linear-gradient(145deg, #f8fdf8, #ffffff);
  border-radius: 16px;
  padding: 25px;
  border: 2px solid #e8f5e9;
}

.direction-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 15px;
  margin: 20px 0;
}

.direction-btn {
  width: 100%;
  height: 80px;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: var(--light-green);
  color: white;
  box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
}

.direction-btn:hover {
  background: var(--primary-green);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
}

.direction-btn:active {
  transform: translateY(0);
}

.direction-btn i {
  font-size: 1.6rem;
}

.btn-center {
  grid-column: 2;
  grid-row: 2;
  display: flex;
  justify-content: center;
  align-items: center;
}

.emergency-btn {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: linear-gradient(145deg, #f44336, #d32f2f);
  color: white;
  border: none;
  font-size: 1.2rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 5px;
  box-shadow: 0 6px 12px rgba(244, 67, 54, 0.4);
  transition: all 0.3s ease;
}

.emergency-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 16px rgba(244, 67, 54, 0.5);
}

.emergency-btn i {
  font-size: 2rem;
}

/* Speed Control */
.speed-control {
  background: linear-gradient(145deg, #f8fdf8, #ffffff);
  border-radius: 16px;
  padding: 25px;
  border: 2px solid #e8f5e9;
}

.speed-slider-container {
  margin: 25px 0;
}

.speed-slider {
  width: 100%;
  height: 10px;
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(to right, #e0e0e0, var(--light-green));
  border-radius: 5px;
  outline: none;
}

.speed-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--primary-green);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.speed-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
  color: var(--neutral-gray);
  font-size: 0.9rem;
}

.speed-display {
  text-align: center;
  margin-top: 20px;
}

.speed-value {
  font-size: 3.5rem;
  font-weight: 800;
  color: var(--primary-green);
  line-height: 1;
}

.speed-unit {
  font-size: 1rem;
  color: var(--neutral-gray);
  margin-top: 5px;
}

/* Action Buttons */
.action-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 20px;
}

.action-btn {
  padding: 18px;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  transition: all 0.3s ease;
}

.action-btn i {
  font-size: 1.3rem;
}

.btn-auto {
  background: linear-gradient(145deg, var(--accent-blue), #1976d2);
  color: white;
  box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
}

.btn-auto:hover {
  background: linear-gradient(145deg, #1976d2, var(--accent-blue));
  transform: translateY(-2px);
}

.btn-record {
  background: linear-gradient(145deg, #9c27b0, #7b1fa2);
  color: white;
  box-shadow: 0 4px 8px rgba(156, 39, 176, 0.3);
}

.btn-record:hover {
  background: linear-gradient(145deg, #7b1fa2, #9c27b0);
  transform: translateY(-2px);
}

.btn-home {
  background: linear-gradient(145deg, #ff9800, #f57c00);
  color: white;
  box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
}

.btn-home:hover {
  background: linear-gradient(145deg, #f57c00, #ff9800);
  transform: translateY(-2px);
}

.btn-pause {
  background: linear-gradient(145deg, #757575, #616161);
  color: white;
  box-shadow: 0 4px 8px rgba(117, 117, 117, 0.3);
}

.btn-pause:hover {
  background: linear-gradient(145deg, #616161, #757575);
  transform: translateY(-2px);
}

/* Status Panel */
.status-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 30px;
  box-shadow: var(--shadow);
  border-top: 6px solid var(--accent-blue);
}

.status-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 25px;
  color: var(--dark-gray);
  font-size: 1.4rem;
}

.status-grid {
  display: grid;
  gap: 20px;
}

.status-item {
  background: #f9f9f9;
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid var(--light-green);
}

.status-item.warning {
  border-left-color: var(--warning-orange);
}

.status-item.danger {
  border-left-color: var(--warning-red);
}

.status-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.status-name {
  font-weight: 600;
  color: var(--dark-gray);
}

.status-value {
  font-weight: 700;
  font-size: 1.1rem;
}

.status-active {
  color: var(--primary-green);
}

.status-warning {
  color: var(--warning-orange);
}

.status-danger {
  color: var(--warning-red);
}

.status-progress {
  margin-top: 10px;
}

.progress-bar {
  height: 6px;
  background: #e0e0e0;
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--light-green);
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Connection Status */
.connection-status {
  margin-top: 25px;
  padding: 20px;
  background: #f0f7f0;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.connection-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #4caf50;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

.connection-text {
  font-weight: 600;
  color: var(--dark-green);
}

/* Map Display */
.map-display {
  background: #f0f7f0;
  border-radius: 12px;
  height: 200px;
  margin-top: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--neutral-gray);
  font-weight: 600;
  position: relative;
  overflow: hidden;
}

.map-grid {
  position: absolute;
  width: 100%;
  height: 100%;
  background-image: 
    linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px);
  background-size: 20px 20px;
}

.vehicle-marker {
  position: absolute;
  width: 30px;
  height: 30px;
  background: var(--primary-green);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

/* Footer */
.footer {
  margin-top: 30px;
  text-align: center;
  padding: 20px;
  color: var(--neutral-gray);
  font-size: 0.9rem;
  border-top: 1px solid #e0e0e0;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  padding: 30px;
  border-radius: 16px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.modal-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  color: var(--dark-green);
}

.modal-header i {
  font-size: 1.8rem;
}

.modal-body {
  margin-bottom: 25px;
  color: var(--dark-gray);
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 15px;
}

.btn-confirm {
  background: var(--primary-green);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.btn-cancel {
  background: #e0e0e0;
  color: var(--dark-gray);
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

/* Responsive */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    text-align: center;
    gap: 20px;
  }
  
  .header-stats {
    width: 100%;
    justify-content: space-around;
  }
  
  .control-interface {
    grid-template-columns: 1fr;
  }
  
  .direction-btn {
    height: 70px;
  }
  
  .emergency-btn {
    width: 80px;
    height: 80px;
  }
}
</style>
</head>

<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div>
        <h1><i class="fas fa-tractor"></i> Advanced Vehicle Control</h1>
        <p class="header-subtitle">Precision control system for agricultural vehicles with real-time monitoring</p>
      </div>
      <div class="header-stats">
        <div class="stat-item">
          <div class="stat-value" id="uptime">98%</div>
          <div class="stat-label">System Uptime</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="battery">87%</div>
          <div class="stat-label">Battery</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="temperature">24°C</div>
          <div class="stat-label">Temp</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Control Panel -->
    <div class="control-panel">
      <div class="panel-header">
        <div class="panel-title">
          <i class="fas fa-gamepad"></i>
          <h2>Control Interface</h2>
        </div>
        <div class="mode-selector">
          <button class="mode-btn active" onclick="setControlMode('manual')">Manual</button>
          <button class="mode-btn" onclick="setControlMode('assisted')">Assisted</button>
          <button class="mode-btn" onclick="setControlMode('auto')">Auto</button>
        </div>
      </div>

      <div class="control-interface">
        <!-- Direction Control -->
        <div class="direction-control">
          <h3 style="color: var(--dark-green); margin-bottom: 15px;">Direction Control</h3>
          <div class="direction-grid">
            <!-- Forward -->
            <button class="direction-btn" onclick="moveVehicle('FORWARD')">
              <i class="fas fa-arrow-up"></i>
              <span>Forward</span>
            </button>
            
            <!-- Empty -->
            <div></div>
            
            <!-- Left -->
            <button class="direction-btn" onclick="moveVehicle('LEFT')">
              <i class="fas fa-arrow-left"></i>
              <span>Left</span>
            </button>
            
            <!-- Emergency Stop -->
            <div class="btn-center">
              <button class="emergency-btn" onclick="emergencyStop()">
                <i class="fas fa-stop"></i>
                <span>STOP</span>
              </button>
            </div>
            
            <!-- Right -->
            <button class="direction-btn" onclick="moveVehicle('RIGHT')">
              <i class="fas fa-arrow-right"></i>
              <span>Right</span>
            </button>
            
            <!-- Empty -->
            <div></div>
            
            <!-- Backward -->
            <button class="direction-btn" onclick="moveVehicle('BACKWARD')">
              <i class="fas fa-arrow-down"></i>
              <span>Backward</span>
            </button>
          </div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control">
          <h3 style="color: var(--dark-green); margin-bottom: 15px;">Speed Control</h3>
          <div class="speed-slider-container">
            <input type="range" min="0" max="100" value="50" class="speed-slider" id="speed-slider" oninput="updateSpeed(this.value)">
            <div class="speed-labels">
              <span>Slow</span>
              <span>Medium</span>
              <span>Fast</span>
            </div>
          </div>
          <div class="speed-display">
            <div class="speed-value" id="speed-display">50</div>
            <div class="speed-unit">% of maximum speed</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn btn-auto" onclick="toggleAutoMode()">
          <i class="fas fa-robot"></i>
          <span id="auto-btn-text">Enable Auto Mode</span>
        </button>
        <button class="action-btn btn-record" onclick="recordPath()">
          <i class="fas fa-record-vinyl"></i>
          <span>Record Path</span>
        </button>
        <button class="action-btn btn-home" onclick="returnToHome()">
          <i class="fas fa-home"></i>
          <span>Return to Home</span>
        </button>
        <button class="action-btn btn-pause" onclick="pauseOperation()">
          <i class="fas fa-pause"></i>
          <span>Pause Operation</span>
        </button>
      </div>
    </div>

    <!-- Status Panel -->
    <div class="status-panel">
      <div class="status-header">
        <i class="fas fa-chart-line"></i>
        <h2>Vehicle Status</h2>
      </div>

      <div class="status-grid">
        <div class="status-item">
          <div class="status-title">
            <span class="status-name">Movement Status</span>
            <span class="status-value status-active" id="movement-status">Idle</span>
          </div>
          <div class="status-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="movement-progress" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-title">
            <span class="status-name">Motor Health</span>
            <span class="status-value status-active" id="motor-health">Excellent</span>
          </div>
          <div class="status-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 95%"></div>
            </div>
          </div>
        </div>

        <div class="status-item warning">
          <div class="status-title">
            <span class="status-name">Obstacle Detection</span>
            <span class="status-value status-warning" id="obstacle-status">2.5m Ahead</span>
          </div>
          <div class="status-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 60%"></div>
            </div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-title">
            <span class="status-name">GPS Accuracy</span>
            <span class="status-value status-active" id="gps-accuracy">±0.8m</span>
          </div>
          <div class="status-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 88%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Connection Status -->
      <div class="connection-status">
        <div class="connection-dot"></div>
        <div class="connection-text">Connected to Vehicle (Strong Signal)</div>
      </div>

      <!-- Map Display -->
      <div class="map-display">
        <div class="map-grid"></div>
        <div class="vehicle-marker" id="vehicle-marker">
          <i class="fas fa-tractor"></i>
        </div>
        <div style="z-index: 2;">Live Vehicle Position</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Advanced Vehicle Control System &copy; 2023 | Smart Agriculture Solutions</p>
    <p>Real-time monitoring active | Vehicle ID: AGRI-VEH-001 | Last command: <span id="last-command">None</span></p>
  </div>
</div>

<!-- Emergency Stop Modal -->
<div class="modal" id="emergency-modal">
  <div class="modal-content">
    <div class="modal-header">
      <i class="fas fa-exclamation-triangle" style="color: #f44336;"></i>
      <h3>Emergency Stop Activated</h3>
    </div>
    <div class="modal-body">
      <p>All vehicle movement has been immediately halted for safety.</p>
      <p><strong>Safety Protocols:</strong></p>
      <ul style="margin-left: 20px; margin-top: 10px;">
        <li>Motors disengaged</li>
        <li>Brakes applied</li>
        <li>Power reduced to standby</li>
        <li>Obstacle detection active</li>
      </ul>
      <p style="margin-top: 15px;">Press "Confirm" to acknowledge and reset safety systems.</p>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-confirm" onclick="confirmEmergencyStop()">Confirm & Reset</button>
    </div>
  </div>
</div>

<!-- Auto Mode Modal -->
<div class="modal" id="auto-modal">
  <div class="modal-content">
    <div class="modal-header">
      <i class="fas fa-robot" style="color: var(--accent-blue);"></i>
      <h3>Autonomous Mode Configuration</h3>
    </div>
    <div class="modal-body">
      <p>Configure autonomous operation parameters:</p>
      <div style="margin: 20px 0;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Operation Area (m²)</label>
        <input type="range" min="100" max="10000" value="1000" style="width: 100%;" id="area-slider" oninput="updateArea(this.value)">
        <div style="text-align: center; margin-top: 10px; font-size: 1.2rem; font-weight: 700; color: var(--primary-green);">
          <span id="area-value">1000</span> m²
        </div>
      </div>
      <div style="margin: 20px 0;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Coverage Pattern</label>
        <select style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
          <option>Grid Pattern (Efficient)</option>
          <option>Spiral Pattern (Precision)</option>
          <option>Custom Path</option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-confirm" onclick="startAutoMode()">Start Autonomous Operation</button>
    </div>
  </div>
</div>

<script>
// State Management
let vehicleState = {
  mode: 'manual', // manual, assisted, auto
  speed: 50,
  movement: 'idle',
  position: { x: 50, y: 50 },
  emergency: false,
  autoMode: false,
  battery: 87,
  motorHealth: 95,
  lastCommand: 'None',
  obstacles: []
};

// DOM Elements
const speedSlider = document.getElementById('speed-slider');
const speedDisplay = document.getElementById('speed-display');
const movementStatus = document.getElementById('movement-status');
const movementProgress = document.getElementById('movement-progress');
const vehicleMarker = document.getElementById('vehicle-marker');
const lastCommandDisplay = document.getElementById('last-command');
const emergencyModal = document.getElementById('emergency-modal');
const autoModal = document.getElementById('auto-modal');
const autoBtnText = document.getElementById('auto-btn-text');

// Initialize
function init() {
  updateStatusDisplay();
  updateVehiclePosition();
  startStatusUpdates();
  
  // Add keyboard controls
  document.addEventListener('keydown', handleKeyPress);
  
  // Add touch support for mobile
  addTouchSupport();
}

// Vehicle Movement Functions
function moveVehicle(direction) {
  if (vehicleState.emergency) {
    alert('Emergency stop active. Reset system first.');
    return;
  }
  
  vehicleState.movement = direction.toLowerCase();
  vehicleState.lastCommand = direction;
  
  // Update UI
  movementStatus.textContent = direction;
  movementStatus.className = 'status-value status-active';
  movementProgress.style.width = '100%';
  
  // Reset progress bar after delay
  setTimeout(() => {
    if (vehicleState.movement === direction.toLowerCase()) {
      movementProgress.style.width = '0%';
      vehicleState.movement = 'idle';
      movementStatus.textContent = 'Idle';
    }
  }, 2000);
  
  // Update last command display
  lastCommandDisplay.textContent = direction;
  
  // Move vehicle marker
  moveVehicleMarker(direction);
  
  // Log action
  logAction(`Vehicle moved ${direction}`);
  
  // In real implementation, send to hardware/Firebase
  // sendToHardware({ command: 'move', direction: direction, speed: vehicleState.speed });
}

function moveVehicleMarker(direction) {
  const step = 5;
  let newX = vehicleState.position.x;
  let newY = vehicleState.position.y;
  
  switch(direction) {
    case 'FORWARD':
      newY = Math.max(10, vehicleState.position.y - step);
      break;
    case 'BACKWARD':
      newY = Math.min(90, vehicleState.position.y + step);
      break;
    case 'LEFT':
      newX = Math.max(10, vehicleState.position.x - step);
      break;
    case 'RIGHT':
      newX = Math.min(90, vehicleState.position.x + step);
      break;
  }
  
  vehicleState.position = { x: newX, y: newY };
  updateVehiclePosition();
}

function updateVehiclePosition() {
  vehicleMarker.style.left = `${vehicleState.position.x}%`;
  vehicleMarker.style.top = `${vehicleState.position.y}%`;
  
  // Add smooth animation
  vehicleMarker.style.transition = 'all 0.5s ease';
  setTimeout(() => {
    vehicleMarker.style.transition = 'all 0.3s ease';
  }, 500);
}

// Speed Control
function updateSpeed(value) {
  vehicleState.speed = parseInt(value);
  speedDisplay.textContent = value;
  
  // Change color based on speed
  if (value > 75) {
    speedDisplay.style.color = '#f44336';
  } else if (value > 50) {
    speedDisplay.style.color = '#ff9800';
  } else {
    speedDisplay.style.color = 'var(--primary-green)';
  }
  
  logAction(`Speed adjusted to ${value}%`);
}

// Control Mode
function setControlMode(mode) {
  vehicleState.mode = mode;
  
  // Update UI
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update auto button text
  if (mode === 'auto') {
    autoBtnText.textContent = 'Auto Mode Active';
    startAutoMode();
  } else {
    autoBtnText.textContent = 'Enable Auto Mode';
    vehicleState.autoMode = false;
  }
  
  logAction(`Switched to ${mode} mode`);
}

// Emergency Functions
function emergencyStop() {
  vehicleState.emergency = true;
  vehicleState.movement = 'emergency_stop';
  
  // Update UI
  movementStatus.textContent = 'EMERGENCY STOP';
  movementStatus.className = 'status-value status-danger';
  movementProgress.style.width = '100%';
  movementProgress.style.background = '#f44336';
  
  // Show modal
  emergencyModal.style.display = 'flex';
  
  // Blink emergency indicator
  const emergencyBtn = document.querySelector('.emergency-btn');
  emergencyBtn.style.animation = 'none';
  setTimeout(() => {
    emergencyBtn.style.animation = 'pulse 0.5s infinite';
  }, 10);
  
  logAction('EMERGENCY STOP ACTIVATED');
}

function confirmEmergencyStop() {
  vehicleState.emergency = false;
  
  // Reset UI
  movementStatus.textContent = 'Idle';
  movementStatus.className = 'status-value status-active';
  movementProgress.style.width = '0%';
  movementProgress.style.background = 'var(--light-green)';
  
  // Close modal
  closeModal();
  
  // Reset emergency button animation
  const emergencyBtn = document.querySelector('.emergency-btn');
  emergencyBtn.style.animation = '';
  
  logAction('Emergency system reset');
}

// Auto Mode Functions
function toggleAutoMode() {
  if (vehicleState.mode === 'auto') {
    // Already in auto mode, show configuration
    autoModal.style.display = 'flex';
  } else {
    // Switch to auto mode
    setControlMode('auto');
  }
}

function startAutoMode() {
  vehicleState.autoMode = true;
  autoBtnText.textContent = 'Auto Mode Active';
  
  // Simulate autonomous operation
  simulateAutoOperation();
  
  // Close modal
  closeModal();
  
  logAction('Autonomous operation started');
}

function simulateAutoOperation() {
  if (!vehicleState.autoMode) return;
  
  // Simulate random movement for demo
  const directions = ['FORWARD', 'LEFT', 'RIGHT'];
  const randomDir = directions[Math.floor(Math.random() * directions.length)];
  
  // Only move if no emergency
  if (!vehicleState.emergency) {
    moveVehicle(randomDir);
    
    // Random obstacle detection simulation
    if (Math.random() > 0.7) {
      detectObstacle();
    }
  }
  
  // Continue auto mode
  setTimeout(simulateAutoOperation, 3000);
}

// Other Functions
function recordPath() {
  logAction('Path recording started');
  alert('Path recording started. Move vehicle to record path.');
}

function returnToHome() {
  vehicleState.position = { x: 50, y: 50 };
  updateVehiclePosition();
  logAction('Returning to home position');
}

function pauseOperation() {
  if (vehicleState.movement !== 'idle') {
    const previousState = vehicleState.movement;
    vehicleState.movement = 'paused';
    movementStatus.textContent = 'PAUSED';
    movementStatus.className = 'status-value status-warning';
    logAction(`Operation paused (was: ${previousState})`);
  }
}

function detectObstacle() {
  const obstacleStatus = document.getElementById('obstacle-status');
  const distance = (Math.random() * 5).toFixed(1);
  obstacleStatus.textContent = `${distance}m Ahead`;
  obstacleStatus.className = 'status-value status-warning';
  
  // Return to normal after 5 seconds
  setTimeout(() => {
    obstacleStatus.textContent = 'Clear';
    obstacleStatus.className = 'status-value status-active';
  }, 5000);
}

// Status Updates
function startStatusUpdates() {
  setInterval(() => {
    // Update battery (simulate discharge)
    if (vehicleState.movement !== 'idle' && vehicleState.battery > 5) {
      vehicleState.battery -= 0.1;
      document.getElementById('battery').textContent = `${Math.round(vehicleState.battery)}%`;
    }
    
    // Update temperature (simulate changes)
    const temp = 20 + Math.random() * 8;
    document.getElementById('temperature').textContent = `${Math.round(temp)}°C`;
    
    // Update motor health (simulate)
    if (Math.random() > 0.95 && vehicleState.motorHealth > 60) {
      vehicleState.motorHealth -= 1;
      updateMotorHealth();
    }
    
    // Update obstacle detection randomly
    if (Math.random() > 0.9) {
      detectObstacle();
    }
  }, 5000);
}

function updateMotorHealth() {
  const motorHealthDisplay = document.getElementById('motor-health');
  motorHealthDisplay.textContent = vehicleState.motorHealth >= 90 ? 'Excellent' :
                                  vehicleState.motorHealth >= 80 ? 'Good' :
                                  vehicleState.motorHealth >= 70 ? 'Fair' : 'Needs Attention';
  
  const color = vehicleState.motorHealth >= 90 ? 'status-active' :
               vehicleState.motorHealth >= 80 ? 'status-warning' : 'status-danger';
  motorHealthDisplay.className = `status-value ${color}`;
}

function updateStatusDisplay() {
  // Update all status displays
  document.getElementById('battery').textContent = `${vehicleState.battery}%`;
  document.getElementById('temperature').textContent = '24°C';
  updateMotorHealth();
}

// Modal Functions
function closeModal() {
  emergencyModal.style.display = 'none';
  autoModal.style.display = 'none';
}

function updateArea(value) {
  document.getElementById('area-value').textContent = value;
}

// Keyboard Controls
function handleKeyPress(event) {
  switch(event.key.toLowerCase()) {
    case 'arrowup':
    case 'w':
      moveVehicle('FORWARD');
      event.preventDefault();
      break;
    case 'arrowleft':
    case 'a':
      moveVehicle('LEFT');
      event.preventDefault();
      break;
    case 'arrowright':
    case 'd':
      moveVehicle('RIGHT');
      event.preventDefault();
      break;
    case 'arrowdown':
    case 's':
      moveVehicle('BACKWARD');
      event.preventDefault();
      break;
    case ' ':
      emergencyStop();
      event.preventDefault();
      break;
    case 'escape':
      closeModal();
      break;
    case '1':
      setControlMode('manual');
      break;
    case '2':
      setControlMode('assisted');
      break;
    case '3':
      setControlMode('auto');
      break;
  }
}

// Touch Support for Mobile
function addTouchSupport() {
  const buttons = document.querySelectorAll('.direction-btn, .action-btn');
  buttons.forEach(button => {
    button.addEventListener('touchstart', function() {
      this.style.opacity = '0.8';
    });
    
    button.addEventListener('touchend', function() {
      this.style.opacity = '1';
    });
  });
}

// Logging Function
function logAction(action) {
  console.log(`[${new Date().toLocaleTimeString()}] ${action}`);
}

// Initialize on load
window.onload = init;
</script>
</body>
</html>
